<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simulador do Mobilizador Especial — Escala 1500</title>
<style>
:root {
  --azul:#003399; --amarelo:#ffcc00; --fundo:#0b152e;
  --card:#111827; --borda:#1f2937; --texto:#f1f5f9; --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,var(--azul),var(--fundo) 60%);
  color:var(--texto); margin:0; padding:30px;
}
h1{color:var(--amarelo);margin-bottom:8px;font-size:28px}
p{color:var(--muted);margin-bottom:16px}
.card{
  background:var(--card);border:1px solid var(--borda);border-radius:14px;
  padding:18px;margin-bottom:18px;box-shadow:0 12px 30px rgba(0,0,0,.35)
}
.grid{display:grid;gap:12px}
.grid.cols-5{grid-template-columns:repeat(5,1fr)}
label{font-size:13px;color:var(--muted);display:block;margin-bottom:3px}
input,select,textarea{
  width:100%;padding:8px 10px;border-radius:10px;border:1px solid var(--borda);
  background:#0b1020;color:var(--texto)
}
input:focus,select:focus,textarea:focus{
  outline:none;border-color:var(--amarelo);
  box-shadow:0 0 0 3px rgba(255,204,0,.25)
}
textarea{min-height:100px;font-family:monospace}
button{
  padding:10px 16px;border:none;border-radius:10px;font-weight:700;
  cursor:pointer;transition:.2s
}
button.primary{background:var(--amarelo);color:#000}
button.primary:hover{background:#ffe75b}
button.ghost{background:#1e293b;color:var(--texto)}
button.ghost:hover{background:#2a3850}
table{width:100%;border-collapse:collapse;background:#0b1020;border-radius:10px;overflow:hidden}
th,td{padding:10px;border-bottom:1px solid var(--borda);text-align:right}
th:first-child,td:first-child{text-align:left}
thead th{background:#16213a;color:var(--amarelo)}
tfoot td{background:#16213a;font-weight:700}
.muted{color:var(--muted)}
.resultado{text-align:center;font-size:18px;font-weight:800;color:var(--amarelo);margin-top:12px}
.hide{display:none}
.selreg{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.tag{background:#0b1020;border:1px solid var(--borda);border-radius:999px;padding:4px 10px;font-size:13px;margin-left:auto}
</style>
</head>
<body>
<h1>Simulador do Mobilizador Especial</h1>
<p>Informe Orçado, Realizado e/ou % de Atingimento. Se algum campo for deixado em branco, o sistema calcula automaticamente. O total máximo equivale a 1500 pontos, e os Pontos Extras são mostrados conforme o atingimento geral.</p>

<div class="card">
  <div class="grid cols-5">
    <!-- gerar 5 mobilizadores -->
    <script>
      for(let i=1;i<=5;i++){
        document.write(`
        <div id="box${i}">
          <label>Mobilizador ${i}</label><input id="n${i}" placeholder="Nome">
          <label>Peso (%)</label><input id="w${i}" placeholder="3">
          <label>Orçado</label><input id="o${i}" placeholder="1000">
          <label>Realizado</label><input id="r${i}" placeholder="950">
          <label>% Atingimento</label><input id="a${i}" placeholder="95">
          <label>Régua Máx</label>
          <select id="sel${i}" onchange="toggleCustom(${i})">
            <option value="115" selected>115%</option>
            <option value="120">120%</option>
            <option value="custom">Personalizada</option>
          </select>
          <textarea id="c${i}" class="hide" placeholder="-99999,99999&#10;0,99499&#10;0&#10;..."></textarea>
        </div>`);
      }
    </script>
  </div>
  <div class="btns" style="margin-top:15px">
    <button class="primary" onclick="calcular()">Calcular</button>
    <button class="ghost" onclick="limpar()">Limpar</button>
    <span id="pesoInfo" class="tag">Soma pesos: 0%</span>
  </div>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Mobilizador</th><th>Régua</th><th>Peso (%)</th><th>Orçado</th><th>Realizado</th>
        <th>% Ating.</th><th>Ating Máx × Peso</th><th>Ating Real × Peso</th>
      </tr>
    </thead>
    <tbody id="tbody"><tr><td colspan="8" class="muted" style="text-align:center">Preencha e clique em Calcular</td></tr></tbody>
    <tfoot><tr><td><b>Total</b></td><td></td><td id="tPeso"></td><td></td><td></td><td></td><td id="tMax"></td><td id="tReal"></td></tr></tfoot>
  </table>
  <div class="resultado" id="resumo">Pontos: 0 | Pontos Extras: 0</div>
</div>

<script>
const BR = s=>parseFloat(String(s||'').trim().replace(/\./g,'').replace(',','.'));
const fmt = (x,d=2)=>Number.isFinite(x)?x.toLocaleString('pt-BR',{minimumFractionDigits:d,maximumFractionDigits:d}):'—';
function toggleCustom(i){document.getElementById('c'+i).classList.toggle('hide',document.getElementById('sel'+i).value!=='custom');}
function bonus(p){if(p>=1500)return 200;if(p>=1400)return 180;if(p>=1300)return 160;if(p>=1200)return 140;if(p>=1100)return 120;if(p>=1000)return 100;return 0;}

function calcular(){
  const tbody=document.getElementById("tbody");tbody.innerHTML="";
  let somaPeso=0,somaAtingMax=0,somaAtingReal=0;

  for(let i=1;i<=5;i++){
    const nome=(document.getElementById("n"+i).value||"").trim()||`Mobilizador ${i}`;
    const peso=BR(document.getElementById("w"+i).value)||0;
    let orcado=BR(document.getElementById("o"+i).value)||0;
    let realizado=BR(document.getElementById("r"+i).value)||0;
    let ating=BR(document.getElementById("a"+i).value);
    const tipo=document.getElementById("sel"+i).value;

    // cálculo automático
    if(!Number.isFinite(ating) && orcado>0 && realizado>0) ating = (realizado/orcado)*100;
    else if(!realizado && orcado>0 && Number.isFinite(ating)) realizado = (ating/100)*orcado;
    else if(!orcado && realizado>0 && Number.isFinite(ating)) orcado = realizado/(ating/100);

    // definir régua máxima
    let atingMax=(tipo==="custom")?115:parseFloat(tipo);
    if(tipo==="custom"){
      const txt=document.getElementById("c"+i).value;
      const linhas=txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      for(let j=1;j<linhas.length;j+=3){let val=BR(linhas[j]);if(val>atingMax)atingMax=val;}
    }

    somaPeso+=peso;
    somaAtingMax+=atingMax*peso;
    somaAtingReal+=ating*peso;

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${nome}</td>
      <td>${tipo==="custom"?"Custom":atingMax.toFixed(1)+"%"}</td>
      <td>${fmt(peso,2)}%</td>
      <td>${orcado?fmt(orcado,2):"—"}</td>
      <td>${realizado?fmt(realizado,2):"—"}</td>
      <td>${fmt(ating,2)}%</td>
      <td>${fmt(atingMax*peso,2)}</td>
      <td>${fmt(ating*peso,2)}</td>`;
    tbody.appendChild(tr);
  }

  document.getElementById("tPeso").textContent=fmt(somaPeso,2)+"%";
  document.getElementById("tMax").textContent=fmt(somaAtingMax,2);
  document.getElementById("tReal").textContent=fmt(somaAtingReal,2);
  document.getElementById("pesoInfo").textContent=`Soma pesos: ${fmt(somaPeso,2)}%`;

  const pts = somaAtingMax>0 ? (somaAtingReal/somaAtingMax)*1500 : 0;
  const extras=bonus(pts);
  document.getElementById("resumo").textContent=`Pontos: ${fmt(pts,2)} | Pontos Extras: ${extras}`;
}

function limpar(){
  for(let i=1;i<=5;i++){
    ['n','w','o','r','a','c'].forEach(id=>document.getElementById(id+i).value="");
    document.getElementById("sel"+i).value="115";toggleCustom(i);
  }
  document.getElementById("tbody").innerHTML='<tr><td colspan="8" class="muted" style="text-align:center">Preencha e clique em Calcular</td></tr>';
  document.getElementById("tPeso").textContent="";
  document.getElementById("tMax").textContent="";
  document.getElementById("tReal").textContent="";
  document.getElementById("pesoInfo").textContent="Soma pesos: 0%";
  document.getElementById("resumo").textContent="Pontos: 0 | Pontos Extras: 0";
}
</script>
</body>
</html>